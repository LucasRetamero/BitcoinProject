{% extends 'base.html' %}
{% load static %}

{% block content %}
<style type="text/css">
.widgets_div {
	border-bottom: thin #edf1f2 solid;
	padding: 22.85px 0;
}

.widgets_div .icon_div {
	display: inline-block;
	margin-left: 15px;
}

.widgets_div .icon_div span i {
	font-size: 24px;
}

.icon_div > span {
  display:table;
}

.widgets_div .text_div {
	display: inline-block;
	margin-left: 10px;
}

.widgets_div .text_div span {
	color: #58666e;
	font-size: 20px;
}

.widgets_div .text_div span + span {
	color: #747F85;
	font-size: 15px;
}
</style>
<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
          <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
            <h1 class="h2">Dashboard - Preço do Bitcoin</h1>
            <!--<div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group mr-2">
                <button class="btn btn-sm btn-outline-secondary">Share</button>
                <button class="btn btn-sm btn-outline-secondary">Export</button>
              </div>
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
                <span data-feather="calendar"></span>
                This week
              </button>
            </div>-->
          </div>
		  
<div class="content">
 <div class="row"> 
  <div class="widgets_div">
          <div class="icon_div">
            <span id='infotime' style="font-weight: bold;font-size: 20px;">10</span>
          </div>
          <div class="text_div">
            <span>Preço do Bitcoin</span><br>
            <span id='info'><!-- value --></span>
          </div>
        </div>
  <div class="col infoCard">
   <!-- other text -->
  </div>  
  <div class="col infoCard">
   <!-- other text -->
  </div> 
 </div> 
</div>
  
<div class="card" style="margin-bottom: 25px;">
  <div class="card-header bg-primary text-white h4">
    Pesquisar preço do Bitcoin pela data
  </div>
  <!-- Error Message -->
  <div id="msgOutputSearchPriceError" class="alert alert-danger" role="alert" style="display: none;">
  <center><b>Operação não realizada !</b></center><br>
   Preencha todos os campos antes de continuar:
  <ul>
   <li class="emptyDayField"><b>Campo <i>Dia</i> não selecionado</b></li>
   <li class="emptyMonthField"><b>Campo <i>Mês</i> não selecionado </b></li>
   <li class="emptyYearField"><b>Campo <i>Ano</i> não selecionado </b></li>
  </ul>
</div>
 <!-- Success Message -->
<div id="msgOutputSearchPriceSuccess" class="alert alert-success" role="alert" style="display: none;">
  <center><b>Operação realizada com sucesso !</b><br>
   <a href="#priceBtc">Ver resultado da pesquisa !</a></center>
</div>
  <div class="form-group">
   <label class="font-weight-bold">Dia <img id="fullDayImg" src="{% static 'img/rightIcon.png' %}" class="img-fluid" width="25px" height="25px" style="display: none;"></img> <img id="emptyDayImg" src="{% static 'img/errorIcon.png' %}" class="img-fluid" width="25px" height="25px" style="display: none;"></img></label>
    <div id="colorCbDay">
     <select class="form-control" id="txtDay" required>
      <option value="Default" selected>Dia</option>
	 </select>
    </div>
   </div>
   
   <div class="form-group">
    <label class="font-weight-bold">Mês <img id="fullMonthImg" src="{% static 'img/rightIcon.png' %}" class="img-fluid" width="25px" height="25px" style="display: none;"></img> <img id="emptyMonthImg" src="{% static 'img/errorIcon.png' %}" class="img-fluid" width="25px" height="25px" style="display: none;"></img></label>
     <div id="colorCbMonth">
      <select class="form-control" id="txtMonth" required>
       <option value="Default" selected>Mês</option>
      </select>
     </div>
   </div>
   
   <div class="form-group">
   <label class="font-weight-bold">Ano <img id="fullYearImg" src="{% static 'img/rightIcon.png' %}" class="img-fluid" width="25px" height="25px" style="display: none;"></img> <img id="emptyYearImg" src="{% static 'img/errorIcon.png' %}" class="img-fluid" width="25px" height="25px" style="display: none;"></img></label>
    <div id="colorCbYear">
     <select class="form-control" id="txtYear" required>
      <option value="Default" selected>Ano</option>
     </select>
    </div>
   </div>
 
  <button type="button" class="btn btn-lg btn-primary text-white w-50 mx-auto" id="checkPrice" style="margin-top: 15px;" data-url="{% url 'PriceSearchData' %}">Verificar preço</button>
 </div>
 
 <div class="card" id="priceBtc" style="display: none">
  <div class="card-header bg-primary text-white h4">
    Resultado da pesquisa
  </div>
  <div class="content">
   <!-- Success Message -->
<div id="msgAfterSearchPriceSuccess" class="alert alert-success" role="alert" style="display: none;">
  <center><b>Operação realizada com sucesso !</b><br>
   <a href="#bitcoinPrice">Ver tabela !</a></center>
</div>
 <div class="row"> 
  <div class="widgets_div">
          <div class="icon_div">
            <span data-feather="dollar-sign" style="width: 35px;height: 35px;"></span>
          </div>
          <div class="text_div">
            <input type="hidden" id="daySave">
            <input type="hidden" id="monthSave">
            <input type="hidden" id="yearSave">
            <span>Preço do Bitcoin</span><br>
            <span id="lblPriceBitcoin"><!-- value here --></span>
          </div>
        </div>
    <div class="widgets_div">
          <div class="icon_div">
            <span data-feather="calendar" style="width: 35px;height: 35px;"></span>
          </div>
           <div class="text_div">
            <span>Data da pesquisa</span><br>
            <span id="lblDatePriceBitcoin"><!-- value here --></span>
           </div>
	</div>
  </div> 
</div>
   <button id="btnToSavePrice" type="button" class="btn btn-block btn-primary text-white w-50 mx-auto" style="margin-bottom: 25px;" data-url= "{% url 'PriceSaveData' %}">Salvar preço</button>		  
 </div>
 
<div class="card" id="priceBtc">
  <div class="card-header bg-primary text-white h4" onclick="ChangeView.showAndHide('#myChart', '#optionPrice')">
    Preço do Bitcoin <span id="optionPrice" style="float: right;font-weight: bold;">-</span>
  </div>
 <canvas class="my-4 w-100" id="myChart" width="900" height="380" data-url="{% url 'PriceAllDataGraph' %}"></canvas>
</div>

<div class="card">
  <div class="card-header bg-primary text-white h4" onclick="ChangeView.showAndHide('#bitcoinPrice', '#optionTbDbPrice')">
    Tabela: Preço do Bitcoin <span id="optionTbDbPrice" style="float: right;font-weight: bold;">-</span>
  </div>
       <div class="table-responsive">
            <table id="bitcoinPrice" class="table table-striped table-sm" data-url="{% url 'PriceAllData' %}">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Preço</th>
				  <th>Menu</th>
                </tr>
              </thead>
              <tbody>
			  {% for val in values %}
			   <tr>
			    <td class="dateBitcoin">{{ val.data|date:'d-m-Y' }}</td>
			    <td class="priceBitcoin">{{ val.preco }}</td>
				<td><button type="button" class="btn btn-warning btnToUpdatePrice"><span data-feather="edit"></span> Editar</button>
				    <button type="button" class="btn btn-danger btnToRemovePrice"><span data-feather="trash-2"></span> Remover</button></td>
				<!--<td><button type="button" class="btn btn-danger" onclick="removePriceBitcoin('{{ val.data|date:'Y-m-d' }}')">Remover</button></td>-->
			   </tr>
			  {% endfor %}
			  <!-- data from ajax -->
              </tbody>
            </table>
          </div>
 </div>
<!-- Modal -->
<div class="modal fade" id="infomationModel" tabindex="-1" role="dialog"  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel"><!-- Here the text--></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="msgOutput" style="font-size:15px;"><!-- Text here --></p>
      </div>
      <div id="btnActionRemove" class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>
<!-- Ask to remove -->
<div class="modal fade" id="infomationModelAskRemove" tabindex="-1" role="dialog"  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Remover data: <label id="lblDateToRemove"> </label>?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="msgOutputRemove" style="font-size:15px;">Deseja realmente remover essa data?</p>
      </div>
	   <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Fechar</button>
		<button type="button" class="btn btn-danger btnActionRemove" data-url="{% url 'PriceRemoveData' %}"><span data-feather="trash-2"></span> Remover</button></td>
     </div>
    </div>
  </div>
</div>

<!-- Form to update price -->
<div class="modal fade" id="infomationModelToUpdate" tabindex="-1" role="dialog"  aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><b>Atualizar Preço</b></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="formToUpdate" class="modal-body">
	   <i>* = Campo editavel</i>
	 <!-- Error Message -->
  <div id="msgOutputUpdatePriceError" class="alert alert-danger" role="alert" style="display: none;">
  <center><b>Operação não realizada !</b></center><br>
   Preencha todos os campos antes de continuar:
  <ul>
   <li class="emptyDateToUpdate"><b>Campo <i>Data</i> não vazio !</b></li>
   <li class="emptyPriceToUpdate"><b>Campo <i>Preço</i> não selecionado</b></li>
  </ul>
</div>
 <!-- Success Message -->
<div id="msgOutputUpdatePriceSuccess" class="alert alert-success" role="alert" style="display: none;">
  <center><b>Operação realizada com sucesso !</b><br>
        Dados atualizados com sucesso !</center>
</div>
   
  <div class="form-group">
    <label for="txtDateUpdate"><b>Data</b></label>
    <input type="text" class="form-control" id="txtDateUpdate" style="background-color: #FFF;" readonly>
  </div>
  <div class="form-group">
    <label for="txtPriceUpdate"><b>Preço(*)</b></label>
    <input type="text" class="form-control" id="txtPriceUpdate">
  </div>
    <div class="form-group">
     <label for="txtOutputPriceUpdate"><b>Resultado Preço</b></label>
     <input type="text" class="form-control" id="txtOutputPriceUpdate" style="background-color: #FFF" readonly>
	</div>
      </div>
	  <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Fechar</button>
		<button type="button" class="btn btn-warning btnActionUpdate" data-url="{% url 'PriceUpdateData' %}"><span data-feather="edit"></span> Atualizar</button></td>
     </div>
    </div>
  </div>
</div>
{% endblock %}


{% block javascript %}
<script src="{% static 'js/DefaultFunction.js' %}"></script> 
<script src="{% static 'js/PriceBitcoin.js' %}"></script> 
<script type="text/javascript">
//Load functions after done page
 $(document).ready(function(){
  //DataToLoad.addValuesInsideElement();
  GraphicConfiguration.showGraphic('{{ dates|safe }}', '{{ prices|safe }}');
  DataToLoad.loadInsidePage();
  DataToLoad.getBtcData();
  DataToLoad.updateBtcData();
 });
</script>	 
{% endblock %}